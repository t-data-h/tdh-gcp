---
# TDH Ansible Common Role
#
- include_vars: ../vars/constants.yml

- name: Check for TDH drop
  stat:
    path: '{{ tdh_drop_file }}'
  register: tdhstat
  
- name: Distribute TDH
  block:
    - name: Create tmp directory
      file:
        path: '{{ tdh_tarball_path }}'
        state: directory
    - name: Copy TDH
      become: true
      copy:
        src: '{{ tdh_drop_file }}'
        dest: '{{ tdh_tarball_path }}'
    - name: Stop TDH
      shell: '/opt/TDH/bin/tdh-init.sh stop'
    - name: Extract tarball
      unarchive:
        src: '{{ tdh_tarball_path }}/{{ tdh_tarball_file }}'
        dest: '/opt'
        creates: '/opt/TDH' 
  when: tdhstat.stat.exists
